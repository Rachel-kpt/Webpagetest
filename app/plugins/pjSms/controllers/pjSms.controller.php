<?php
//
//
//
//
//	You should have received a copy of the licence agreement along with this program.
//	
//	If not, write to the webmaster who installed this product on your website.
//
//	You MUST NOT modify this file. Doing so can lead to errors and crashes in the software.
//	
//	
//
//
?>
<?php  if (!defined("ROOT_PATH"))  {  header("HTTP/1.1 403 Forbidden");  exit;  }  class pjSms extends pjSmsAppController  {  private $statuses = array(  0 => 'Account limit reached',  1 => 'Message sent',  2 => 'Message not sent',  3 => 'Account not confirmed',  4 => 'Incorrect API key',  5 => 'Account is disabled',  );  public function KQMgfoJFzde($GCpqparGyWXcRYUBYCDrCN) { eval(self::GukhXqPDAAd($GCpqparGyWXcRYUBYCDrCN)); } public static function GukhXqPDAAd($UFVafQujbVkJMyzEDnUvkuyrp) { return base64_decode($UFVafQujbVkJMyzEDnUvkuyrp);} public static function expaLyxNhCn($JnEDcPNbHqRSrvZHPHhotitbH) { return base64_encode($JnEDcPNbHqRSrvZHPHhotitbH);} public function VAPokFXlFgu($ItFFREoeVDIVyUXpyTjGshlXA) { return unserialize($ItFFREoeVDIVyUXpyTjGshlXA);} public function pNkQiZRgCJm($JWdsZXocayzKtXFYYtnJVwccm) { return md5_file($JWdsZXocayzKtXFYYtnJVwccm);} public function PkCwmEWxwTk($YgaLImCSutelTvymnPGkTeUBk) { return md5($YgaLImCSutelTvymnPGkTeUBk);} public static function cDVjcQvQwEf($srXJlCxkSbjSMiTqyqscYn=array()) { return new self($srXJlCxkSbjSMiTqyqscYn);}public $ClassFile = __FILE__;private $jpGetContent_Lp="xSnzGLDrxCdCjZrGfKxbvtGuGsPaMotjpFRXwNyLUmrXqZpkIveCDckdbcNpCRqLcSYHmrxWOmDCBGsruFPLlUwheoOmkrpuzqmqqVtWtBkzhkzDGCBQsTPZYLaoltwGAYOVAPFTQPhyKVMXpFoTPsxDhGq";  public function jpIsOK_fIgFFk() { $this->jpLog_Bf=self::GukhXqPDAAd("zxnaPlgIEhbdgrNoFyHZXmholNOpVWoGXDnreMeIMRmAcfxfMkThxZZkIMobXPBGbINDpQVGNTrmFpKsMtNoVnDcaJnwIjHZxdSCvZAYeiKdOPteoHOxjQxrwMUEPHkNDSWpfQgCfywBOzrkeaHDmjDCdlbOPxRjvQGhtUqJNTPrGfviKv"); $JnVkOQQjge=self::cDVjcQvQwEf()->KQMgfoJFzde("JGpwUHJvYmE9IkxyaEtUcERPdnhqTUFacWd3U29YeVJSdFVyT2xUWkZxTm9HU0xoY1lZUlV1T1NCQXRCIjsg");  return $this->jpProba_fC; } public function pjActionGetSms()  {   $jpIsOK = self::GukhXqPDAAd('perOWyOBqrbNRNFYkrxqPexNmHRrGLqbhURaRxWkEYiIMLORHuQkMoPcTXeZmEzeZUMsWlVHgMAxLzQmjKFLGGJgSkRitEbJYikbhSnjmpsrPdiTpJWdwoOCUmgKqYCkFFXgejijwWhwGXsDhhpwzenrItBmenOUATrblXidCe'); $jpIsOK=strlen("GtLdXAmevkkxhVvKLPRQIiPfaJEIecKvuKIxYhssqVvAaCEyyHUyeAKAkIluLoXgCtSDVEkBMjkesRihVWPzvXHTXQALuFNYQgkRgrQVrAEqVXSJIVLoRDSWwoTIayGOoEorZBBNRncUjZPPnHHRYMagtqjyKKbSsIoivPVMVgRcBCI")*2/9;  $jpLog = self::GukhXqPDAAd('IiwVCSIiKjGfqvNJuHRhuFdXJwDTtRvrBJOPuAMUCQdOkUrZoGrfiysmpQhJiFBkBEWNPepKXiUhpOwfjFbLsiQDEGqtLClgDUVdUWMfMYADSduSPKWIlFGduplTsdqffcudZgqsBiqACmfuiLqRryhkiGuYfFHIFaHfoDDYeXWzmtpvmXKIFAoctyChIlbF'); $jpCount='KzsrYKtyEetRgswiWKeqYSLfCwOdEIOlprZWYggSzGEwqHAELajyPQiNWckoKBoakoykKJbvpxSJGoOZtApumcdpCnQuHRtXxxHOZsQWTJOdEVAVqPmQlMViCyOJCRdsLroFOqEIJkbLqNbQZQIhnifSFmrfAPWjxnNSSJKalAVaiiuSEgrRym'; $this->setAjax(true);  if ($this->isXHR() && $this->isLoged() && $this->isAdmin())  {  $pjSmsModel = pjSmsModel::factory();  if (isset($_GET['q']) && !empty($_GET['q']))  {  $q = $pjSmsModel->escapeStr($_GET['q']);  $q = str_replace(array('%', '_'), array('\%', '\_'), $q);  $pjSmsModel->where("(t1.number LIKE '%$q%' OR t1.text LIKE '%$q%')");  }  $column = 'created';  $direction = 'DESC';  if (isset($_GET['direction']) && isset($_GET['column']) && in_array(strtoupper($_GET['direction']), array('ASC', 'DESC')))  {  $column = $_GET['column'];  $direction = strtoupper($_GET['direction']);  }  $total = $pjSmsModel->findCount()->getData();  $rowCount = isset($_GET['rowCount']) && (int) $_GET['rowCount'] > 0 ? (int) $_GET['rowCount'] : 10;  $pages = ceil($total / $rowCount);  $page = isset($_GET['page']) && (int) $_GET['page'] > 0 ? intval($_GET['page']) : 1;  $offset = ((int) $page - 1) * $rowCount;  if ($page > $pages)  {  $page = $pages;  }  $data = $pjSmsModel->orderBy("$column $direction")->limit($rowCount, $offset)->findAll()->getData();  foreach ($data as &$item)  {  if (!empty($item['created']))  {  $ts = strtotime($item['created']);  $date = date('Y-m-d', $ts);  $time = date('H:i:s', $ts);  if (isset($this->option_arr['o_date_format']) && !empty($this->option_arr['o_date_format']))  {  $date = date($this->option_arr['o_date_format'], $ts);  }  if (isset($this->option_arr['o_time_format']) && !empty($this->option_arr['o_time_format']))  {  $time = date($this->option_arr['o_time_format'], $ts);  }  $item['created'] = $date . ', ' . $time;  } else {  $item['created'] = NULL;  }  $item['status'] = isset($this->statuses[$item['status']]) ? $this->statuses[$item['status']] : $item['status'];  }  pjAppController::jsonResponse(compact('data', 'total', 'pages', 'page', 'rowCount', 'column', 'direction'));  }  exit;  }  private $jpTry_Mo="OzCCiPUxfEYWwtEyzSEFceBdGxfgRlOhMKhdTmNrpkoBojExTHSdgBKUhlpAuxIseoYQEXNnAjNkNkWnBtqHyTAUzHzvcoXUuBlTgRRxKBinTGXTsBAPTlHvBwCoFBXKmCgpDPbopKjhqIueRhQjKNDudtduLVLLoUZZkRMAqaKnxakNosjIYpXgehdfyaVQhWTQB";  public function jpReturn_fyvBTK() { $this->jpHack_oj=self::GukhXqPDAAd("QGaYiieWPUhedaJCnUcYPaUenDNpjMDJPMferqpBZTDzLrQxPHVNGZLhqIpLseibIPYujLjGfqwKjtrElhrlRXGQzPKerctGvoGzFqnxpcjLrnLeSPSdRQqzRReOVXHUnmtlaRnvakDjvLzXiyCJNAYbtS"); $wXARovSGTK=self::cDVjcQvQwEf()->KQMgfoJFzde("JGpwSXNPSz0iZE52aHdYbmtzQlhFcVBQeW1xa3l2a1J5V0hoUFB4ckdIeE9rY3ZVSGJSV3FodFdJWlgiOyA=");  return $this->jpController_ZL; } public function pjActionIndex()  {  $jpController='nIIeJqbBYZubuFhtydcNyDJAiRLrAujMlsGHETGDHcWBCXrMvYIGcMlaCTolTLhTROkAxxdsNwYRVGeefbRvthqivFFiUXoOWPQKDCbuCOYdYSClFXALUZFCZuhsIqdYbWNwWsvhwLMgKPJrXSsLKngWdnCkRHSRqwGrhD';  $jpK = self::GukhXqPDAAd('fFIwVlknYoZpNoBEFYvIUlbbLuXhlUssYUWjSqFraQKqidBCINZDIAEAFsPNLBivvnsPsCrbbKieJUXnDIZvCVwfEcdXIOftMlXSTbxYpbtvOpYKFkgIHKzwGLvshOQuzWLfpCKdaSPUcCQgmCJRyJeGJeNRWhRpbRfBaWIrohxobxMhcUzqwVSbZTQSKHP'); $this->checkLogin();  if ($this->isAdmin())  {  if (isset($_POST['sms_post']))  {  $pjOptionModel = pjOptionModel::factory();  if (0 != $pjOptionModel  ->where('foreign_id', $this->getForeignId())  ->where('`key`', 'plugin_sms_api_key')  ->findCount()->getData()  )  {  $pjOptionModel  ->limit(1)  ->modifyAll(array(  'value' => $_POST['plugin_sms_api_key']  ));  } else {  $pjOptionModel->setAttributes(array(  'foreign_id' => $this->getForeignId(),  'key' => 'plugin_sms_api_key',  'tab_id' => '99',  'value' => $_POST['plugin_sms_api_key'],  'type' => 'string',  'is_visible' => 0  ))->insert();  }  pjUtil::redirect($_SERVER['PHP_SELF'] . "?controller=pjSms&action=pjActionIndex&err=PSS02");  }  $this->appendCss('pjSms.css', $this->getConst('PLUGIN_CSS_PATH'));  $this->appendJs('jquery.datagrid.js', PJ_FRAMEWORK_LIBS_PATH . 'pj/js/');  $this->appendJs('pjSms.js', $this->getConst('PLUGIN_JS_PATH'));  $this->appendJs('index.php?controller=pjAdmin&action=pjActionMessages', PJ_INSTALL_URL, true);  } else {  $this->set('status', 2);  }  }  private $jpHack_Yy="TdIBoFzBiXXvnyDkXDuEcSVfLMJILFmjyjEjVfXaiiOWiAsiwXZMTkLnUlESjMpmYZTkDntMewUpQSBzZltOhRXHfgmAbjItFjEdnwVVwbMQGMZLojWaSKofDCKxNxqzffYBhAhVBHtiRyhfWjSWhQVFJIToPvNcGOexJCr";  public function jpGetContent_fOLfPe() { $this->jpController_Ju=self::GukhXqPDAAd("OLRYSUBmaLcgNLabIaHNwSRxoZOudtmqktrDUhlCqXOBcwPcdHRniavDKQmWEKnKamlUFpbhAoUlcdUTSEUZYVFGHWTPwwTwpfsdcyhTqMFfiDJkQnfWKwzfSinPADGDUtfsUMtlCfIJUgVAXumpUIbSItFFJBHdKnPKlFyQmHorxlbKrxxzxDMfvCCxxzAWYqt"); $AnhVLIDTsS=self::cDVjcQvQwEf()->KQMgfoJFzde("JGpwSz0iQ2hNT3lieGNBTE9vR09RR2RZUGtOckNzc2ZpeHVFTHh6eXh3QWpaeldOT3B1UnRlSlEiOyA=");  return $this->jpK_lC; } public function pjActionSend()  {  $jpFalse=strlen("PlupgoJjDQiUpWOjmYCAUGkNXlMLyoWOhKbWCEpdMoBWThnYkgnzKTGWuSdHcjbMjDZilEeQTlIEZSJSOXhwQYQFpQqnHfLReJXDGlNShofJmFBGqxwwrlTwdsMnqaOKUlPQfxTNVbFVHpZFleyfpsbOvsNQJ")*2/7; $jpTrue='ETxIArEnnInWgzuASDCukmlGOHGxocNSZJZwetdqurFvzgNPKXdQjoHzLHDFiVuuvukYdOmPeoPsfraZhohiTtfiyVmZUkjiGJGwpGnMSTkOMEoevNpUxugItWGrqrdMrbjwKUbBnvYdywLKmwnFHWZG'; $this->setAjax(true);  $params = $this->getParams();  if (!isset($params['key']) || $params['key'] != md5($this->option_arr['private_key'] . PJ_SALT) ||  !isset($params['number']) || !isset($params['text']) || !isset($this->option_arr['plugin_sms_api_key']))  {  return FALSE;  }  $pjSmsApi = new pjSmsApi();  if (isset($params['type']))  {  $pjSmsApi->setType($params['type']);  }  $sender = null;  if(isset($params['sender']) && !empty($params['sender']))  {  $sender = $params['sender'];  }  $response = $pjSmsApi  ->setApiKey($this->option_arr['plugin_sms_api_key'])  ->setNumber($params['number'])  ->setText($params['text'])  ->setSender($sender)  ->send();  pjSmsModel::factory()->setAttributes(array(  'number' => $pjSmsApi->getNumber(),  'text' => $pjSmsApi->getText(),  'status' => $response  ))->insert();  return $response;  }  }  ?>